!function i(o,l,s){function c(t,e){if(!l[t]){if(!o[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(d)return d(t,!0);var a=new Error("Cannot find module '"+t+"'");throw a.code="MODULE_NOT_FOUND",a}var r=l[t]={exports:{}};o[t][0].call(r.exports,function(e){return c(o[t][1][e]||e)},r,r.exports,i,o,l,s)}return l[t].exports}for(var d="function"==typeof require&&require,e=0;e<s.length;e++)c(s[e]);return c}({1:[function(e,t,n){"use strict";var a,k=(a=e("deepmerge"))&&a.__esModule?a:{default:a};e("fs");function U(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],a=!0,r=!1,i=void 0;try{for(var o,l=e[Symbol.iterator]();!(a=(o=l.next()).done)&&(n.push(o.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==l.return||l.return()}finally{if(r)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}window.FileUploader=function(t,e){var T=this,f=this;this._defaults={lang:"en",useFileIcons:!0,debug:!1,debugLogStyle:"color: #9900ff",name:void 0,pluginName:"FileUploader",useLoadingBars:!0,loadingBarsClasses:[],reloadedFilesClass:"reloadedElement",resultContainerClass:"result",resultFileContainerClass:"uploadedFile",resultPrefix:"fileUploader",resultInputNames:["title","extension","value","size"],defaultFileExt:"",defaultMimeType:"",maxFileSize:50,maxTotalSize:1e3,maxNumberOfFiles:!1,reloadArray:[],reloadHTML:void 0,linkButtonContent:"L",deleteButtonContent:"X",allowDuplicates:!1,duplicatesWarning:!1,labelsContainers:!1,labelsClasses:{sizeAvailable:"sizeAvailable",currentSize:"currentSize",maxFileSize:"maxFileSize",maxTotalSize:"maxTotalSize"},HTMLTemplate:function(){return'<p class="introMsg"></p>\n                    <div>\n                        <div class="inputContainer">\n                            <input class="fileLoader" type="file" multiple />\n                        </div>\n                        <div class="dropZone"></div>\n                        <div class="filesContainer filesContainerEmpty">\n                            <div class="innerFileThumbs"></div>\n                            <div style="clear:both;"></div>\n                        </div>\n                    </div>\n                    <div class="result"></div>'},onload:function(){},onfileloadStart:function(){},onfileloadEnd:function(){},onfileDelete:function(){},filenameTest:function(){},langs:{en:{intro_msg:"(Add attachments...)",dropZone_msg:"Drop your files here",maxSizeExceeded_msg:"File too large",maxTotalSizeExceeded_msg:"Total size exceeded",duplicated_msg:"File duplicated (skipped)",name_placeHolder:"name"}}};var M=function(e,t){var n=!0,a=!1,r=void 0;try{for(var i,o=l["".concat(e,"Labels")][Symbol.iterator]();!(n=(i=o.next()).done);n=!0)i.value.querySelector(":scope > span").innerHTML=t}catch(e){a=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(a)throw r}}};this._options=(0,k.default)(this._defaults,e),this.options=function(e){return e?(0,k.default)(T._options,e):T._options},this._round=function(e){return Math.round(100*e)/100},this.get=function(e){switch(e){case"currentTotalSize":return T._round(F);case"currentAvailableSize":return T._round(T._options.maxTotalSize-F)}},this._logger=function(e,t,n){if(T._options.debug){if(t)for(var a=0;a<t;a++)e="âž¡ "+e;T._options.name&&(e="["+T._options.pluginName+" - "+T._options.name+"] "+e),n?console.log("%c "+e,T._options.debugLogStyle,n):console.log("%c "+e,T._options.debugLogStyle)}},this._fileType=function(e){var t=e.substring(e.lastIndexOf(".")+1,e.length);return 0<=["pdf","jpg","png"].indexOf(t)?t:"unknown-file"},this._fileDelete=function(e,t){var n=t.element,a=e.target.dataset.delete;a||(a=e.target.closest("div[data-delete]").dataset.delete),T._options.useFileIcons&&function(e,t){var n=e.previousElementSibling;if(!t)return n;for(;n;){if(n.matches(t))return n;n=n.previousElementSibling}}(n,"img").remove(),n.remove();var r=E.querySelector('input[name="'.concat(T._options.resultPrefix,"[").concat(a,"][").concat(T._options.resultInputNames[3],']"]')).value;r=T._round(r),F=T._round(F-r),I--;var i=T._options.maxTotalSize-F;i=T._round(i),M("sizeAvailable",i),M("currentSize",F),E.querySelector(':scope > div[data-index="'.concat(a,'"]')).remove(),0===document.querySelector(".innerFileThumbs").children.length&&document.querySelector(".filesContainer").classList.add("filesContainerEmpty"),T._logger("Deleted file N: "+a,2),T._options.onfileDelete(a,F)},this._fileRename=function(e){var t=e.data.element,n=e.target,a=t.querySelector(":scope > .fileExt").innerHTML,r=n.value,i=t.dataset.index,o=E.querySelector('div[data-index="'.concat(i,'"] input')),l=T._options.filenameTest(r,a,A);if(!1===l)return e.preventDefault(),!1;void 0!==l&&!0!==l&&(r=l,n.value=r,o.value=r,n.setSelectionRange(e.data.start,e.data.stop))},this.getData=function(){var e=[];T._logger("RECEIVED SAVE COMMAND:",0);var t=!0,n=!1,a=void 0;try{for(var r,i=E.querySelectorAll(":scope > .".concat(T._options.resultFileContainerClass))[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var o=r.value.querySelectorAll(":scope > input"),l={title:o[0].value,ext:o[1].value,value:o[2].value};e.push(l)}}catch(e){n=!0,a=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw a}}return T._logger("%O",0,e),e},this._createUploaderContainer=function(e,t,n){if(T._options.useFileIcons){var a='<img src="/images/'.concat(T._fileType(n),'.png" class="fileThumb" />');A.insertAdjacentHTML("beforeend",a)}var r=document.createElement("div");r.className="newElement",r.dataset.index=parseInt(e),r.style.position="relative",A.appendChild(r);var i=document.createElement("div");i.className="fileActions",r.appendChild(i);var o=document.createElement("div");o.className="fileSee",o.innerHTML=T._options.linkButtonContent,i.appendChild(o),o.addEventListener("click",function(e){var t=e.target.closest(".newElement").dataset.index,n=E.querySelector('.uploadedFile[data-index="'.concat(t,'"] textarea')).value;window.open().document.write('<iframe src="'.concat(n,'" frameborder="0" style="border:0; top:0px; display:block; left:0px; bottom:0px; right:0px; width:100%; min-height: 100vh; height:100%;" allowfullscreen></iframe>'))});var l=document.createElement("div");if(l.className="fileDelete",l.dataset.delete=parseInt(e),l.innerHTML=T._options.deleteButtonContent,i.append(l),l.addEventListener("click",function(e){T._fileDelete(e,{element:r})}),T._options.useLoadingBars){var s=T._options.loadingBarsClasses;0<s.length&&(s=s.join(" "));var c=document.createElement("div");c.className="loadBar ".concat(s),c.appendChild(document.createElement("div")),r.prepend(c)}var d=document.createElement("input");d.setAttribute("placeholder","nome"),d.className="fileTitle";var u=document.createElement("div");return u.className="fileExt",r.prepend(u),r.prepend(d),function(e,t,n){t instanceof Array||this._logger("addMultipleListeners requires events to be an array");var a=!0,r=!1,i=void 0;try{for(var o,l=t[Symbol.iterator]();!(a=(o=l.next()).done);a=!0){var s=o.value;e.addEventListener(s,n)}}catch(e){r=!0,i=e}finally{try{a||null==l.return||l.return()}finally{if(r)throw i}}}(d,["keypress","keyup","paste"],function(e){e.data={},e.data.element=r,e.data.start=this.selectionStart,e.data.stop=this.selectionEnd,f._fileRename(e)}),d.value=t,u.innerHTML=n,r},this._createResultContainer=function(e){var t=e.index,n=document.createElement("div");n.className=T._options.resultFileContainerClass,n.dataset.index=t,n.insertAdjacentHTML("beforeend","<div>File: ".concat(t,"</div>")),n.insertAdjacentHTML("beforeend",'<input type="text" name="'.concat(T._options.resultPrefix,"[").concat(t,"][").concat(T._options.resultInputNames[0],']" value="').concat(e.name,'" />')),n.insertAdjacentHTML("beforeend",'<input type="text" name="'.concat(T._options.resultPrefix,"[").concat(t,"][").concat(T._options.resultInputNames[1],']" value="').concat(e.type,'" />')),n.insertAdjacentHTML("beforeend",'<textarea name="'.concat(T._options.resultPrefix,"[").concat(t,"][").concat(T._options.resultInputNames[2],']">').concat(e.result,"</textarea>")),n.insertAdjacentHTML("beforeend",'<input type="text" name="'.concat(T._options.resultPrefix,"[").concat(t,"][").concat(T._options.resultInputNames[3],']" value="').concat(e.size,'" />')),E.appendChild(n)},this._filesRead=function(e){var t,n=e.data.DOM,a=!1,r=0;if(t=e.target.files?(T._logger("files array source: file selector (click event)",1),e.target.files):(T._logger("files array source: dropzone (drag & drop event)",1),e.dataTransfer.files),T._logger("%O",0,t),!T._options.allowDuplicates){var i=[],o=[],l=!0,s=!(a=[]),c=void 0;try{for(var d,u=E.children[Symbol.iterator]();!(l=(d=u.next()).done);l=!0){var f=d.value;i.push(f.querySelector("input").value)}}catch(e){s=!0,c=e}finally{try{l||null==u.return||u.return()}finally{if(s)throw c}}for(r=0;r<t.length;r++)o.push(t[r].name);o.forEach(function(e){i.indexOf(e)<0&&a.push(e)})}z.classList.remove("filesContainerEmpty");var p=function(l,s,c,e){var i=Array.from(e.querySelector(".innerFileThumbs").children).filter(function(e){return parseInt(e.dataset.index)===c});i=i[0];var d=T._round(s.size/1e6);l.onloadstart=function(){T._options.onfileloadStart(c),T._logger("START read file: ".concat(c,", size: ").concat(d," MB"),2)},l.onprogress=function(e){if(e.lengthComputable){var t=T._round(e.loaded/e.total*100);T._logger("File ".concat(c," loaded: ").concat(t),3),t<=100&&(i.querySelector(":scope > .loadBar > div").style.width="100%")}},l.onloadend=function(){var e=s.type,t=s.name,n=l.result;if(!n)return!1;"data:"===n.substring(0,n.indexOf(";"))&&0<T._options.defaultMimeType.length&&(n="data:"+T._options.defaultMimeType+n.substring(n.indexOf(";"),n.length)),""===e&&(e=T._options.defaultMimeType),t.indexOf(".")<0&&""!==T._options.defaultFileExt&&(t="".concat(t,".").concat(T._options.defaultFileExt));var a={index:c,name:t,type:e,result:n,size:d};T._createResultContainer(a),T._logger("END read file: ".concat(c),4);var r=document.getElementById("debugUploaded"),i=parseInt(r.innerHTML)+1;r.innerHTML=i;var o={name:s.name,type:s.type,data:n,size:d};T._options.onfileloadEnd(c,o,T._round(F))},console.log("current number of files: ".concat(I," / ").concat(T._options.maxNumberOfFiles)),d<T._options.maxFileSize&&F+d<T._options.maxTotalSize&&I<T._options.maxNumberOfFiles?function(e){l.readAsDataURL(s),F+=d,I++;var t=e._round(e._options.maxTotalSize-F);M("sizeAvailable",t),M("currentSize",F)}(T):function(e){var t=C.maxTotalSizeExceeded_msg;d>e._options.maxFileSize?(t=C.maxSizeExceeded_msg,e._logger("FILE REJECTED: Max size exceeded - max size: ".concat(e._options.maxFileSize," MB - file size: ").concat(d," MB"))):e._logger("FILE REJECTED: Max total size exceeded - max size: ".concat(e._options.maxTotalSizeExceeded_msg," MB - current total size: ").concat(F+d," MB")),i.classList.add("error");var n=i.querySelector(":scope > .loadBar");n.innerHTML="",n.insertAdjacentHTML("beforeend",'<div class="errorMsg">'.concat(t,"</div>")),setTimeout(function(){e._options.useFileIcons&&i.getPreviousSibling("img").remove(),i.remove()},2e3);var a=document.getElementById("debugRejected"),r=parseInt(a.innerHTML)+1;a.innerHTML=r}(T)},v=document.querySelector(".innerFileThumbs").children,m=v[v.length-1].getAttribute("index");function g(e){setTimeout(function(){e.remove()},2e3)}for(m=void 0!==m?parseInt(m)+1:0,r=0;r<t.length;r++){var h=t[r],_=new FileReader;if(a&&a.indexOf(h.name)<0){if(T._options.duplicatesWarning){var y=document.createElement("div");y.className="errorLabel center",y.innerHTML=C.duplicated_msg,A.appendChild(y),g(y)}T._logger("File duplicated: ".concat(h.name," -> skipping..."),2)}else{var b=void 0,x=void 0;x=0<h.name.lastIndexOf(".")?(b=h.name.substring(0,h.name.lastIndexOf(".")),h.name.substring(h.name.lastIndexOf(".")+1,h.name.length)):(b=h.name,T._options.defaultFileExt);var S=T._options.filenameTest(b,x,A);!1!==S?(void 0!==S&&!0!==S&&(b=S),T._createUploaderContainer(L,b,x),p(_,h,L,n),L++):T._logger("Invalid file name: ".concat(h.name),2)}}},this._options.name&&this._logger("INITIALIZED INSTANCE: "+this._options.name);var n=this._options.HTMLTemplate();t.insertAdjacentHTML("beforeend",n);var L=0,E=t.querySelector("."+this._options.resultContainerClass),a=t.querySelector(".fileLoader"),z=t.querySelector(".filesContainer"),A=t.querySelector(".innerFileThumbs"),r=t.querySelector(".dropZone"),C=this._options.langs[this._options.lang];this._options.reloadHTML&&(E.innerHTML=this._options.reloadHTML),t.querySelector(".introMsg").innerHTML=C.intro_msg,r.innerHTML=C.dropZone_msg,this._options.debug?(E.insertAdjacentHTML("beforebegin",'<p class="debugMode">Debug mode: on</p>'),E.insertAdjacentHTML("beforebegin",'<div class="debug">Uploaded files: <span id="debugUploaded">0</span> | Rejected files: <span id="debugRejected">0</span></div>'),E.insertAdjacentHTML("beforebegin",'<div class="debug">Current MAX FILE SIZE: '+this._options.maxFileSize+" MB</div>"),E.insertAdjacentHTML("beforebegin",'<div class="debug">Current MAX TOTAL SIZE: '+this._options.maxTotalSize+" MB</div>"),E.insertAdjacentHTML("beforebegin",'<div class="debug sizeAvailable">Size still available: <span>'+this._options.maxTotalSize+"</span> MB</div>")):E.classList.add("hide");var l={},i=this._options.labelsClasses;for(var o in i)l["".concat(o,"Labels")]=[];var s=this._options.labelsContainers;if(this._options.debug&&l.sizeAvailableLabels.push(t.querySelector(".".concat(i.sizeAvailable))),s){var c=function(e){return document.querySelector(e)};for(var d in i){var u=function(e,t,n){if(e){var a=e.querySelector(".".concat(t[n]));a&&l["".concat(n,"Labels")].push(a)}else this._logger("impossible to find labelContainer '".concat(selector,"'"),1)};if(Array.isArray(s)){var p=!0,v=!1,m=void 0;try{for(var g,h=s[Symbol.iterator]();!(p=(g=h.next()).done);p=!0)u(c(g.value),i,d)}catch(e){v=!0,m=e}finally{try{p||null==h.return||h.return()}finally{if(v)throw m}}}else{var _=c(s);if(_){var y=_.querySelector(".".concat(i[d]));y&&l["".concat(d,"Labels")].push(y)}else this._logger("impossible to find labelContainer '".concat(s,"'"),1)}}}M("maxFileSize",this._options.maxFileSize),M("maxTotalSize",this._options.maxTotalSize);var b,F=0,I=0,x=!0,S=!1,O=void 0;try{for(var q,H=E.querySelectorAll(":scope > .".concat(this._options.resultFileContainerClass)).entries()[Symbol.iterator]();!(x=(q=H.next()).done);x=!0){var D=U(q.value,2),j=(D[0],D[1]);this._logger("found previously uploaded file: index = ".concat(j.dataset.index),2);var w=j.querySelectorAll(":scope > input"),N=w[0].value,B=w[1].value,R=w[3].value;0<N.lastIndexOf(".")&&(N=N.substr(0,N.lastIndexOf("."))),(b=this._createUploaderContainer(L,N,B)).querySelector(":scope > .loadBar > div").style.width="100%",b.classList.add(this._options.reloadedFilesClass),F+=parseFloat(R),I++,L++}}catch(e){S=!0,O=e}finally{try{x||null==H.return||H.return()}finally{if(S)throw O}}return 0<this._options.reloadArray.length&&this._options.reloadArray.forEach(function(e,t){(b=T._createUploaderContainer(t,e.name,e.ext)).querySelector(":scope > .loadBar > div").style.width="100%",b.classList.add(T._options.reloadedFilesClass),T._logger("found previously uploaded file: index = "+t,2);var n={index:t,name:e.name,type:e.ext,result:e.data,size:e.size};T._createResultContainer(n),F+=parseFloat(e.size),I++,L++}),F=this._round(F),this._logger("current total size: ".concat(F," - current number of files: ").concat(I)),M("sizeAvailable",this._options.maxTotalSize-F),M("currentSize",F),this._options.onload(this._options,F),this.handleDragOver=function(e){r.classList.add("highlight"),e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},this.handleDrop=function(e){r.classList.remove("highlight"),e.data={DOM:t},T._filesRead(e)},r.addEventListener("dragleave",function(){r.classList.remove("highlight")}),r.addEventListener("dragover",this.handleDragOver),r.addEventListener("drop",function(){event.stopPropagation(),event.preventDefault(),T.handleDrop(event)}),r.addEventListener("click",function(e){a.click()}),a.addEventListener("change",function(e){e.data={DOM:t},T._filesRead(e),T.value=null}),{fileUploader:f,elementDOM:t}}},{deepmerge:3,fs:2}],2:[function(e,t,n){},{}],3:[function(e,t,n){var a,r;a=this,r=function(){"use strict";var r=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===n}(e)}(e)};var n="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function i(e,t){return!1!==t.clone&&t.isMergeableObject(e)?s(function(e){return Array.isArray(e)?[]:{}}(e),e,t):e}function o(e,t,n){return e.concat(t).map(function(e){return i(e,n)})}function l(t,n,a){var r={};return a.isMergeableObject(t)&&Object.keys(t).forEach(function(e){r[e]=i(t[e],a)}),Object.keys(n).forEach(function(e){a.isMergeableObject(n[e])&&t[e]?r[e]=function(e,t){if(!t.customMerge)return s;var n=t.customMerge(e);return"function"==typeof n?n:s}(e,a)(t[e],n[e],a):r[e]=i(n[e],a)}),r}function s(e,t,n){(n=n||{}).arrayMerge=n.arrayMerge||o,n.isMergeableObject=n.isMergeableObject||r;var a=Array.isArray(t);return a===Array.isArray(e)?a?n.arrayMerge(e,t,n):l(e,t,n):i(t,n)}return s.all=function(e,n){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(e,t){return s(e,t,n)},{})},s},"object"==typeof n&&void 0!==t?t.exports=r():"function"==typeof define&&define.amd?define(r):a.deepmerge=r()},{}]},{},[1]);
//# sourceMappingURL=fileUploader.js.map
