!function o(r,l,s){function d(t,e){if(!l[t]){if(!r[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(u)return u(t,!0);var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}var a=l[t]={exports:{}};r[t][0].call(a.exports,function(e){return d(r[t][1][e]||e)},a,a.exports,o,r,l,s)}return l[t].exports}for(var u="function"==typeof require&&require,e=0;e<s.length;e++)d(s[e]);return d}({1:[function(e,t,n){"use strict";var i,l=(i=e("deepmerge"))&&i.__esModule?i:{default:i};function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}window.FileUploader=function(t,e){var h=this,m=this;console.log(m),this._defaults={lang:"en",useFileIcons:!0,debug:!1,debugLogStyle:"color: #9900ff",name:void 0,pluginName:"FileUploader",useLoadingBars:!0,loadingBarsClasses:[],reloadedFilesClass:"reloadedElement",resultContainerClass:"result",resultFileContainerClass:"uploadedFile",resultPrefix:"fileUploader",resultInputNames:["title","extension","value","size"],defaultFileExt:"",defaultMimeType:"",fileMaxSize:50,totalMaxSize:1e3,reloadArray:[],reloadHTML:void 0,linkButtonContent:"L",deleteButtonContent:"X",allowDuplicates:!1,duplicatesWarning:!1,HTMLTemplate:function(){return'<p class="introMsg"></p>\n                    <div>\n                        <div class="inputContainer">\n                            <input class="fileLoader" type="file" multiple />\n                        </div>\n                        <div class="dropZone"></div>\n                        <div class="filesContainer filesContainerEmpty">\n                            <div class="innerFileThumbs"></div>\n                            <div style="clear:both;"></div>\n                        </div>\n                    </div>\n                    <div class="result"></div>'},onload:function(){},onfileloadStart:function(){},onfileloadEnd:function(){},onfileDelete:function(){},filenameTest:function(){},langs:{en:{intro_msg:"(Add attachments...)",dropZone_msg:"Drop your files here",maxSizeExceeded_msg:"File too large",totalMaxSizeExceeded_msg:"Total size exceeded",duplicated_msg:"File duplicated (skipped)",name_placeHolder:"name"}}},this._options=(0,l.default)(this._defaults,e),this.options=function(e){return e?(0,l.default)(h._options,e):h._options},this._round=function(e){return Math.round(100*e)/100},this.get=function(e){switch(e){case"currentTotalSize":return h._round(S);case"currentAvailableSize":return h._round(h._options.totalMaxSize-S)}},this._logger=function(e,t,n){if(h._options.debug){if(t)for(var i=0;i<t;i++)e="âž¡ "+e;h._options.name&&(e="["+h._options.pluginName+" - "+h._options.name+"] "+e),n?console.log("%c "+e,h._options.debugLogStyle,n):console.log("%c "+e,h._options.debugLogStyle)}},this._fileType=function(e){var t=e.substring(e.lastIndexOf(".")+1,e.length);return 0<=["pdf","jpg","png"].indexOf(t)?t:"unknown-file"},this._fileDelete=function(e){var t=e.data.element,n=e.target.dataset.delete;n||(n=e.target.closest("div[data-delete]").dataset.delete),h._options.useFileIcons&&t.prev("img").remove(),t.remove();var i=y.find('input[name="'+h._options.resultPrefix+"["+n+"]["+h._options.resultInputNames[3]+']"]').val();i=h._round(i),S=h._round(S-i);var a=h._options.totalMaxSize-S;a=h._round(a),E.children("span").html(a),y.children('div[data-index="'+n+'"]').remove(),0===$(".innerFileThumbs").children().length&&$(".filesContainer").addClass("filesContainerEmpty"),h._logger("Deleted file N: "+n,2),h._options.onfileDelete(n,S)},this._fileRename=function(e){var t=e.data.element,n=$(e.target),i=t.children(".fileExt").html(),a=n.val(),o=t.data("index"),r=y.find('div[data-index="'+o+'"] input:first'),l=h._options.filenameTest(a,i,M);if(!1===l)return e.preventDefault(),!1;void 0!==l&&!0!==l&&(a=l,n.val(a),0<i.length&&(a=a+"."+i),r.val(a),n[0].setSelectionRange(e.data.start,e.data.stop))},this.getData=function(){var i=[];return h._logger("RECEIVED SAVE COMMAND:",0),$.each(y.children("."+h._options.resultFileContainerClass),function(e,t){var n={title:$($(t).children("input")[0]).val(),ext:$($(t).children("input")[1]).val(),value:$($(t).children("input")[2]).val()};i.push(n)}),h._logger("%O",0,i),i},this._createUploaderContainer=function(e,t,n){if(h._options.useFileIcons){var i=$('<img src="/images/'+h._fileType(n)+'.png" class="fileThumb" />');M.append(i)}var a=$('<div class="newElement" data-index="'+parseInt(e)+'" style="position: relative;"></div');M.append(a);var o=$('<div class="fileActions"></div>');a.append(o);var r=$('<a target="_blank"><div class="fileSee">'+h._options.linkButtonContent+"</div></a>");o.append(r);var l=$('<div data-delete="'+parseInt(e)+'" class="fileDelete">'+h._options.deleteButtonContent+"</div>");if(o.append(l),l.click({element:a},h._fileDelete),h._options.useLoadingBars){var s=h._options.loadingBarsClasses;0<s.length&&(s=s.join(" "));var d=$('<div class="loadBar '+s+'"><div></div></div>');a.prepend(d)}var u=$('<input placeholder="nome" class="fileTitle"></input>'),p=$('<div class="fileExt"></div>');return a.prepend(p),a.prepend(u),u.on("keypress keyup paste",function(e){e.data={},e.data.element=a,e.data.start=this.selectionStart,e.data.stop=this.selectionEnd,this._fileRename(e)}),u.val(t),p.html(n),a},this._createResultContainer=function(e){var t=e.index,n=$('<div data-index="'+t+'" class="'+h._options.resultFileContainerClass+'"></div>');n.append($("<div>File: "+t+"</div>")),n.append($("<input/>").attr({type:"text",name:h._options.resultPrefix+"["+t+"]["+h._options.resultInputNames[0]+"]",value:e.name})),n.append($("<input/>").attr({type:"text",name:h._options.resultPrefix+"["+t+"]["+h._options.resultInputNames[1]+"]",value:e.type})),n.append($("<input/>").attr({type:"text",name:h._options.resultPrefix+"["+t+"]["+h._options.resultInputNames[2]+"]",value:e.result})),n.append($("<input/>").attr({type:"text",name:h._options.resultPrefix+"["+t+"]["+h._options.resultInputNames[3]+"]",value:e.size})),y.append(n)},this._filesRead=function(e){var t,n=e.data.DOM,i=!1,a=0;if(t=e.target.files?(h._logger("files array source: file selector (click event)",1),e.target.files):(h._logger("files array source: dropzone (drag & drop event)",1),e.dataTransfer.files),h._logger("%O",0,t),!h._options.allowDuplicates){var o=[],r=[];for(i=[],$.each(y.children(),function(e,t){o.push($(t).children("input").first().val())}),a=0;a<t.length;a++)r.push(t[a].name);r.forEach(function(e){o.indexOf(e)<0&&i.push(e)})}x.removeClass("filesContainerEmpty"),b.html("upload files");var l=function(r,l,s,e){var d=e.find(".innerFileThumbs").children().filter(function(){return $(this).data("index")===s}),u=h._round(l.size/1e6);if(r.onloadstart=function(){h._options.onfileloadStart(s),h._logger("START read file: "+s+", size: "+u+" MB",2)},r.onprogress=function(e){if(e.lengthComputable){var t=h._round(e.loaded/e.total*100);h._logger("File "+s+" loaded: "+t,3),t<=100&&d.children(".loadBar").children("div").animate({width:"100%"},500)}},r.onloadend=function(){var e=l.type,t=l.name,n=r.result;if(!n)return!1;"data:"===n.substring(0,n.indexOf(";"))&&0<h._options.defaultMimeType.length&&(n="data:"+h._options.defaultMimeType+n.substring(n.indexOf(";"),n.length)),""===e&&(e=h._options.defaultMimeType),t.indexOf(".")<0&&""!==h._options.defaultFileExt&&(t=t+"."+h._options.defaultFileExt);var i={index:s,name:t,type:e,result:n,size:u};h._createResultContainer(i),d.children(".fileActions").children("a").attr("href",n),h._logger("END read file: "+s,4);var a=parseInt($("#debugUploaded").html())+1;$("#debugUploaded").html(a);var o={name:l.name,type:l.type,data:n,size:u};h._options.onfileloadEnd(s,o,h._round(S))},u<=h._options.fileMaxSize&&S+u<=h._options.totalMaxSize){r.readAsDataURL(l),S+=u;var t=h._options.totalMaxSize-S;E.children("span").html(h._round(t))}else{var n=C.totalMaxSizeExceeded_msg;u>h._options.fileMaxSize?(n=C.maxSizeExceeded_msg,h._logger("FILE REJECTED: Max size exceeded - max size: "+h._options.fileMaxSize+" MB - file size: "+u+" MB")):h._logger("FILE REJECTED: Max total size exceeded - max size: "+h._options.totalMaxSizeExceeded_msg+" MB - current total size: "+(S+u)+" MB"),d.addClass("error"),d.children(".loadBar").empty().append('<div class="errorMsg">'+n+"</div>"),setTimeout(function(){d.animate({opacity:0},300,function(){m._options.useFileIcons&&$(this).prev("img").remove(),$(this).remove()})},2e3);var i=parseInt($("#debugRejected").html())+1;$("#debugRejected").html(i)}},s=$("#innerFileThumbs").children().last().attr("id");function d(e){setTimeout(function(){e.animate({opacity:0},300,function(){$(this).remove()})},2e3)}for(s=void 0!==s?parseInt(s.substring(s.indexOf("-")+1,s.length))+1:0,a=0;a<t.length;a++){var u=t[a],p=new FileReader;if(i&&i.indexOf(u.name)<0){if(h._options.duplicatesWarning){var f=$('<div class="errorLabel center"></div>');f.html(C.duplicated_msg),M.append(f),d(f)}h._logger("File duplicated: "+u.name+" -> skipping...",2)}else{var c,v;v=0<u.name.lastIndexOf(".")?(c=u.name.substring(0,u.name.lastIndexOf(".")),u.name.substring(u.name.lastIndexOf(".")+1,u.name.length)):(c=u.name,h._options.defaultFileExt);var g=h._options.filenameTest(c,v,M);!1!==g?(void 0!==g&&!0!==g&&(c=g),h._createUploaderContainer(_,c,v),l(p,u,_,n),_++):h._logger("Invalid file name: "+u.name,2)}}},this._options.name&&this._logger("INITIALIZED INSTANCE: "+this._options.name);var n=$(this._options.HTMLTemplate());t.append(n);var _=0,y=t.find("."+this._options.resultContainerClass),i=t.find(".fileLoader"),x=t.find(".filesContainer"),b=t.find(".fileNameContainer"),M=t.find(".innerFileThumbs"),a=t.find(".dropZone")[0],C=this._options.langs[this._options.lang];this._options.reloadHTML&&y.html(this._options.reloadHTML),t.find(".introMsg").html(C.intro_msg),$(a).html(C.dropZone_msg),this._options.debug?($('<p class="debugMode">Debug mode: on</p>').insertBefore(y),$('<div class="debug">Uploaded files: <span id="debugUploaded">0</span> | Rejected files: <span id="debugRejected">0</span></div>').insertBefore(y),$('<div class="debug">Current MAX FILE SIZE: '+this._options.fileMaxSize+" MB</div>").insertBefore(y),$('<div class="debug">Current MAX TOTAL SIZE: '+this._options.totalMaxSize+" MB</div>").insertBefore(y),$('<div class="debug sizeAvailable">Size still available: <span>'+this._options.totalMaxSize+"</span> MB</div>").insertBefore(y)):y.addClass("hide");var r,o,E=t.find(".sizeAvailable"),S=0;$.each(y.children("."+this._options.resultFileContainerClass),function(e,t){h._logger("found previously uploaded file: index = "+$(t).data("index"),2);var n=$(t).children("input"),i=$(n[0]).val(),a=$(n[1]).val(),o=$(n[3]).val();0<i.lastIndexOf(".")&&(i=i.substr(0,i.lastIndexOf("."))),(r=h._createUploaderContainer(_,i,a)).children(".loadBar").children("div").css({width:"100%"}),r.addClass(h._options.reloadedFilesClass),S+=parseFloat(o),_++}),0<this._options.reloadArray.length&&this._options.reloadArray.forEach(function(e,t){(r=h._createUploaderContainer(t,e.name,e.ext)).children(".loadBar").children("div").css({width:"100%"}),r.addClass(h._options.reloadedFilesClass),h._logger("found previously uploaded file: index = "+t,2);var n={index:t,name:e.name,type:e.ext,result:e.data,size:e.size};h._createResultContainer(n),S+=parseFloat(e.size),_++}),S=this._round(S),this._logger("current total size: "+S),E.children("span").html(this._options.totalMaxSize-S),this._options.onload(this._options,S),this.handleDragOver=function(e){$(a).addClass("highlight"),e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},this.handleDrop=function(e){$(a).removeClass("highlight"),e.stopPropagation(),e.preventDefault(),e.data={DOM:t},h._filesRead(e)},a.addEventListener("dragleave",function(){$(a).removeClass("highlight")}),a.addEventListener("dragover",this.handleDragOver,!1),a.addEventListener("drop",(o=this,function(e){h.handleDrop(e,o)}),!1),$(a).click(function(){i.trigger("click")}),i.change({DOM:t},function(e){h._filesRead(e),h.value=null})},$.fn.fileUploader=function(e){var i=this,a="string"==typeof e?e:void 0;if(a){var o=[];this.each(function(){var e=$(i).data("fileUploader");o.push(e)});var r=1<arguments.length?Array.prototype.slice.call(arguments,1):void 0,l=[];return this.each(function(e){var t=o[e];if(!t)return console.warn("$.fileUploader not instantiated yet"),console.info(i),void l.push(void 0);if("function"==typeof t[a]){var n=t[a].apply(t,r);l.push(n)}else console.warn("Method '"+a+"' not defined in $.fileUploader")}),1<l.length?l:l[0]}var n="object"===s(e)?e:void 0;return this.each(function(){var e=$(i),t=new FileUploader(e,n);e.data("fileUploader",t)})}},{deepmerge:2}],2:[function(e,t,n){var i,a;i=this,a=function(){"use strict";var a=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===n}(e)}(e)};var n="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function o(e,t){return!1!==t.clone&&t.isMergeableObject(e)?s(function(e){return Array.isArray(e)?[]:{}}(e),e,t):e}function r(e,t,n){return e.concat(t).map(function(e){return o(e,n)})}function l(t,n,i){var a={};return i.isMergeableObject(t)&&Object.keys(t).forEach(function(e){a[e]=o(t[e],i)}),Object.keys(n).forEach(function(e){i.isMergeableObject(n[e])&&t[e]?a[e]=function(e,t){if(!t.customMerge)return s;var n=t.customMerge(e);return"function"==typeof n?n:s}(e,i)(t[e],n[e],i):a[e]=o(n[e],i)}),a}function s(e,t,n){(n=n||{}).arrayMerge=n.arrayMerge||r,n.isMergeableObject=n.isMergeableObject||a;var i=Array.isArray(t);return i===Array.isArray(e)?i?n.arrayMerge(e,t,n):l(e,t,n):o(t,n)}return s.all=function(e,n){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(e,t){return s(e,t,n)},{})},s},"object"==typeof n&&void 0!==t?t.exports=a():"function"==typeof define&&define.amd?define(a):i.deepmerge=a()},{}]},{},[1]);
//# sourceMappingURL=fileUploader.js.map
