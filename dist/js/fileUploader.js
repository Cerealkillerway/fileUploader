!function a(o,l,s){function d(t,e){if(!l[t]){if(!o[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(c)return c(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var i=l[t]={exports:{}};o[t][0].call(i.exports,function(e){return d(o[t][1][e]||e)},i,i.exports,a,o,l,s)}return l[t].exports}for(var c="function"==typeof require&&require,e=0;e<s.length;e++)d(s[e]);return d}({1:[function(e,t,n){"use strict";var r,_=(r=e("deepmerge"))&&r.__esModule?r:{default:r};function y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,l=e[Symbol.iterator]();!(r=(o=l.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==l.return||l.return()}finally{if(i)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}window.FileUploader=function(t,e){var S=this,T=this;this._defaults={lang:"en",useFileIcons:!0,debug:!1,debugLogStyle:"color: #9900ff",name:void 0,pluginName:"FileUploader",useLoadingBars:!0,loadingBarsClasses:[],reloadedFilesClass:"reloadedElement",resultContainerClass:"result",resultFileContainerClass:"uploadedFile",resultPrefix:"fileUploader",resultInputNames:["title","extension","value","size"],defaultFileExt:"",defaultMimeType:"",fileMaxSize:50,totalMaxSize:1e3,reloadArray:[],reloadHTML:void 0,linkButtonContent:"L",deleteButtonContent:"X",allowDuplicates:!1,duplicatesWarning:!1,HTMLTemplate:function(){return'<p class="introMsg"></p>\n                    <div>\n                        <div class="inputContainer">\n                            <input class="fileLoader" type="file" multiple />\n                        </div>\n                        <div class="dropZone"></div>\n                        <div class="filesContainer filesContainerEmpty">\n                            <div class="innerFileThumbs"></div>\n                            <div style="clear:both;"></div>\n                        </div>\n                    </div>\n                    <div class="result"></div>'},onload:function(){},onfileloadStart:function(){},onfileloadEnd:function(){},onfileDelete:function(){},filenameTest:function(){},langs:{en:{intro_msg:"(Add attachments...)",dropZone_msg:"Drop your files here",maxSizeExceeded_msg:"File too large",totalMaxSizeExceeded_msg:"Total size exceeded",duplicated_msg:"File duplicated (skipped)",name_placeHolder:"name"}}},this._options=(0,_.default)(this._defaults,e),this.options=function(e){return e?(0,_.default)(S._options,e):S._options},this._round=function(e){return Math.round(100*e)/100},this.get=function(e){switch(e){case"currentTotalSize":return S._round(F);case"currentAvailableSize":return S._round(S._options.totalMaxSize-F)}},this._logger=function(e,t,n){if(S._options.debug){if(t)for(var r=0;r<t;r++)e="âž¡ "+e;S._options.name&&(e="["+S._options.pluginName+" - "+S._options.name+"] "+e),n?console.log("%c "+e,S._options.debugLogStyle,n):console.log("%c "+e,S._options.debugLogStyle)}},this._fileType=function(e){var t=e.substring(e.lastIndexOf(".")+1,e.length);return 0<=["pdf","jpg","png"].indexOf(t)?t:"unknown-file"},this._fileDelete=function(e,t){var n=t.element,r=e.target.dataset.delete;r||(r=e.target.closest("div[data-delete]").dataset.delete),S._options.useFileIcons&&function(e,t){var n=e.previousElementSibling;if(!t)return n;for(;n;){if(n.matches(t))return n;n=n.previousElementSibling}}(n,"img").remove(),n.remove();var i=L.querySelector('input[name="'.concat(S._options.resultPrefix,"[").concat(r,"][").concat(S._options.resultInputNames[3],']"]')).value;i=S._round(i),F=S._round(F-i);var a=S._options.totalMaxSize-F;a=S._round(a),I.querySelector(":scope > span").innerHTML=a,L.querySelector(':scope > div[data-index="'.concat(r,'"]')).remove(),0===document.querySelector(".innerFileThumbs").children.length&&document.querySelector(".filesContainer").classList.add("filesContainerEmpty"),S._logger("Deleted file N: "+r,2),S._options.onfileDelete(r,F)},this._fileRename=function(e){var t=e.data.element,n=e.target,r=t.querySelector(":scope > .fileExt").innerHTML,i=n.value,a=t.dataset.index,o=L.querySelector('div[data-index="'.concat(a,'"] input')),l=S._options.filenameTest(i,r,C);if(!1===l)return e.preventDefault(),!1;void 0!==l&&!0!==l&&(i=l,n.value=i,o.value=i,n.setSelectionRange(e.data.start,e.data.stop))},this.getData=function(){var e=[];S._logger("RECEIVED SAVE COMMAND:",0);var t=!0,n=!1,r=void 0;try{for(var i,a=L.querySelectorAll(":scope > .".concat(S._options.resultFileContainerClass))[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value.querySelectorAll(":scope > input"),l={title:o[0].value,ext:o[1].value,value:o[2].value};e.push(l)}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}return S._logger("%O",0,e),e},this._createUploaderContainer=function(e,t,n){if(S._options.useFileIcons){var r='<img src="/images/'.concat(S._fileType(n),'.png" class="fileThumb" />');C.insertAdjacentHTML("beforeend",r)}var i=document.createElement("div");i.className="newElement",i.dataset.index=parseInt(e),i.style.position="relative",C.appendChild(i);var a=document.createElement("div");a.className="fileActions",i.appendChild(a);var o='<a target="_blank"><div class="fileSee">'.concat(S._options.linkButtonContent,"</div></a>");a.insertAdjacentHTML("beforeend",o);var l=document.createElement("div");if(l.className="fileDelete",l.dataset.delete=parseInt(e),l.innerHTML=S._options.deleteButtonContent,a.append(l),l.addEventListener("click",function(e){S._fileDelete(e,{element:i})}),S._options.useLoadingBars){var s=S._options.loadingBarsClasses;0<s.length&&(s=s.join(" "));var d=document.createElement("div");d.className="loadBar ".concat(s),d.appendChild(document.createElement("div")),i.prepend(d)}var c=document.createElement("input");c.setAttribute("placeholder","nome"),c.className="fileTitle";var u=document.createElement("div");return u.className="fileExt",i.prepend(u),i.prepend(c),function(e,t,n){t instanceof Array||this._logger("addMultipleListeners requires events to be an array");var r=!0,i=!1,a=void 0;try{for(var o,l=t[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var s=o.value;e.addEventListener(s,n)}}catch(e){i=!0,a=e}finally{try{r||null==l.return||l.return()}finally{if(i)throw a}}}(c,["keypress","keyup","paste"],function(e){e.data={},e.data.element=i,e.data.start=this.selectionStart,e.data.stop=this.selectionEnd,T._fileRename(e)}),c.value=t,u.innerHTML=n,i},this._createResultContainer=function(e){var t=e.index,n=document.createElement("div");n.className=S._options.resultFileContainerClass,n.dataset.index=t,n.insertAdjacentHTML("beforeend","<div>File: ".concat(t,"</div>")),n.insertAdjacentHTML("beforeend",'<input type="text" name="'.concat(S._options.resultPrefix,"[").concat(t,"][").concat(S._options.resultInputNames[0],']" value="').concat(e.name,'" />')),n.insertAdjacentHTML("beforeend",'<input type="text" name="'.concat(S._options.resultPrefix,"[").concat(t,"][").concat(S._options.resultInputNames[1],']" value="').concat(e.type,'" />')),n.insertAdjacentHTML("beforeend",'<input type="text" name="'.concat(S._options.resultPrefix,"[").concat(t,"][").concat(S._options.resultInputNames[2],']" value="').concat(e.result,'" />')),n.insertAdjacentHTML("beforeend",'<input type="text" name="'.concat(S._options.resultPrefix,"[").concat(t,"][").concat(S._options.resultInputNames[3],']" value="').concat(e.size,'" />')),L.appendChild(n)},this._filesRead=function(e){var t,n=e.data.DOM,r=!1,i=0;if(t=e.target.files?(S._logger("files array source: file selector (click event)",1),e.target.files):(S._logger("files array source: dropzone (drag & drop event)",1),e.dataTransfer.files),S._logger("%O",0,t),!S._options.allowDuplicates){var a=[],o=[],l=!0,s=!(r=[]),d=void 0;try{for(var c,u=L.children[Symbol.iterator]();!(l=(c=u.next()).done);l=!0){var p=c.value;a.push(p.querySelector("input").value)}}catch(e){s=!0,d=e}finally{try{l||null==u.return||u.return()}finally{if(s)throw d}}for(i=0;i<t.length;i++)o.push(t[i].name);o.forEach(function(e){a.indexOf(e)<0&&r.push(e)})}A.classList.remove("filesContainerEmpty");var f=function(l,s,d,e){var c=Array.from(e.querySelector(".innerFileThumbs").children).filter(function(e){return parseInt(e.dataset.index)===d});c=c[0];var u=S._round(s.size/1e6);if(l.onloadstart=function(){S._options.onfileloadStart(d),S._logger("START read file: ".concat(d,", size: ").concat(u," MB"),2)},l.onprogress=function(e){if(e.lengthComputable){var t=S._round(e.loaded/e.total*100);S._logger("File ".concat(d," loaded: ").concat(t),3),t<=100&&(c.querySelector(":scope > .loadBar > div").style.width="100%")}},l.onloadend=function(){var e=s.type,t=s.name,n=l.result;if(!n)return!1;"data:"===n.substring(0,n.indexOf(";"))&&0<S._options.defaultMimeType.length&&(n="data:"+S._options.defaultMimeType+n.substring(n.indexOf(";"),n.length)),""===e&&(e=S._options.defaultMimeType),t.indexOf(".")<0&&""!==S._options.defaultFileExt&&(t="".concat(t,".").concat(S._options.defaultFileExt));var r={index:d,name:t,type:e,result:n,size:u};S._createResultContainer(r),c.querySelector(":scope > .fileActions > a").setAttribute("href",n),S._logger("END read file: ".concat(d),4);var i=document.getElementById("debugUploaded"),a=parseInt(i.innerHTML)+1;i.innerHTML=a;var o={name:s.name,type:s.type,data:n,size:u};S._options.onfileloadEnd(d,o,S._round(F))},u<=S._options.fileMaxSize&&F+u<=S._options.totalMaxSize){l.readAsDataURL(s),F+=u;var t=S._options.totalMaxSize-F;I.querySelector(":scope > span").innerHTML=S._round(t)}else{var n=z.totalMaxSizeExceeded_msg;u>S._options.fileMaxSize?(n=z.maxSizeExceeded_msg,S._logger("FILE REJECTED: Max size exceeded - max size: ".concat(S._options.fileMaxSize," MB - file size: ").concat(u," MB"))):S._logger("FILE REJECTED: Max total size exceeded - max size: ".concat(S._options.totalMaxSizeExceeded_msg," MB - current total size: ").concat(F+u," MB")),c.classList.add("error");var r=c.querySelector(":scope > .loadBar");r.innerHTML="",r.insertAdjacentHTML("beforeend",'<div class="errorMsg">'.concat(n,"</div>")),setTimeout(function(){T._options.useFileIcons&&c.getPreviousSibling("img").remove(),c.remove()},2e3);var i=parseInt(document.getElementById("debugRejected")),a=i.innerHTML+1;i.innerHTML=a}},v=document.querySelector(".innerFileThumbs").children,g=v[v.length-1].getAttribute("index");function m(e){setTimeout(function(){e.remove()},2e3)}for(g=void 0!==g?parseInt(g)+1:0,i=0;i<t.length;i++){var _=t[i],y=new FileReader;if(r&&r.indexOf(_.name)<0){if(S._options.duplicatesWarning){var h=document.createElement("div");h.className="errorLabel center",h.innerHTML=z.duplicated_msg,C.appendChild(h),m(h)}S._logger("File duplicated: ".concat(_.name," -> skipping..."),2)}else{var M=void 0,b=void 0;b=0<_.name.lastIndexOf(".")?(M=_.name.substring(0,_.name.lastIndexOf(".")),_.name.substring(_.name.lastIndexOf(".")+1,_.name.length)):(M=_.name,S._options.defaultFileExt);var x=S._options.filenameTest(M,b,C);!1!==x?(void 0!==x&&!0!==x&&(M=x),S._createUploaderContainer(E,M,b),f(y,_,E,n),E++):S._logger("Invalid file name: ".concat(_.name),2)}}},this._options.name&&this._logger("INITIALIZED INSTANCE: "+this._options.name);var n=this._options.HTMLTemplate();t.insertAdjacentHTML("beforeend",n);var E=0,L=t.querySelector("."+this._options.resultContainerClass),r=t.querySelector(".fileLoader"),A=t.querySelector(".filesContainer"),C=t.querySelector(".innerFileThumbs"),i=t.querySelector(".dropZone"),z=this._options.langs[this._options.lang];this._options.reloadHTML&&(L.innerHTML=this._options.reloadHTML),t.querySelector(".introMsg").innerHTML=z.intro_msg,i.innerHTML=z.dropZone_msg,this._options.debug?(L.insertAdjacentHTML("beforebegin",'<p class="debugMode">Debug mode: on</p>'),L.insertAdjacentHTML("beforebegin",'<div class="debug">Uploaded files: <span id="debugUploaded">0</span> | Rejected files: <span id="debugRejected">0</span></div>'),L.insertAdjacentHTML("beforebegin",'<div class="debug">Current MAX FILE SIZE: '+this._options.fileMaxSize+" MB</div>"),L.insertAdjacentHTML("beforebegin",'<div class="debug">Current MAX TOTAL SIZE: '+this._options.totalMaxSize+" MB</div>"),L.insertAdjacentHTML("beforebegin",'<div class="debug sizeAvailable">Size still available: <span>'+this._options.totalMaxSize+"</span> MB</div>")):L.classList.add("hide");var a,I=t.querySelector(".sizeAvailable"),F=0,o=!0,l=!1,s=void 0;try{for(var d,c=L.querySelectorAll(":scope > .".concat(this._options.resultFileContainerClass)).entries()[Symbol.iterator]();!(o=(d=c.next()).done);o=!0){var u=y(d.value,2),p=(u[0],u[1]);this._logger("found previously uploaded file: index = ".concat(p.dataset.index),2);var f=p.querySelectorAll(":scope > input"),v=f[0].value,g=f[1].value,m=f[3].value;0<v.lastIndexOf(".")&&(v=v.substr(0,v.lastIndexOf("."))),(a=this._createUploaderContainer(E,v,g)).querySelector(":scope > .loadBar > div").style.width="100%",a.classList.add(this._options.reloadedFilesClass),F+=parseFloat(m),E++}}catch(e){l=!0,s=e}finally{try{o||null==c.return||c.return()}finally{if(l)throw s}}return 0<this._options.reloadArray.length&&this._options.reloadArray.forEach(function(e,t){(a=S._createUploaderContainer(t,e.name,e.ext)).querySelector(":scope > .loadBar > div").style.width="100%",a.classList.add(S._options.reloadedFilesClass),S._logger("found previously uploaded file: index = "+t,2);var n={index:t,name:e.name,type:e.ext,result:e.data,size:e.size};S._createResultContainer(n),F+=parseFloat(e.size),E++}),F=this._round(F),this._logger("current total size: "+F),I.querySelector(":scope > span").innerHTML=this._options.totalMaxSize-F,this._options.onload(this._options,F),this.handleDragOver=function(e){i.classList.add("highlight"),e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},this.handleDrop=function(e){i.classList.remove("highlight"),e.stopPropagation(),e.preventDefault(),e.data={DOM:t},S._filesRead(e)},i.addEventListener("dragleave",function(){i.classList.remove("highlight")}),i.addEventListener("dragover",this.handleDragOver,!1),i.addEventListener("drop",function(t){return function(e){S.handleDrop(e,t)}},!1),i.addEventListener("click",function(e){r.click()}),r.addEventListener("change",function(e){e.data={DOM:t},S._filesRead(e),S.value=null}),{fileUploader:T,elementDOM:t}}},{deepmerge:2}],2:[function(e,t,n){var r,i;r=this,i=function(){"use strict";var i=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===n}(e)}(e)};var n="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function a(e,t){return!1!==t.clone&&t.isMergeableObject(e)?s(function(e){return Array.isArray(e)?[]:{}}(e),e,t):e}function o(e,t,n){return e.concat(t).map(function(e){return a(e,n)})}function l(t,n,r){var i={};return r.isMergeableObject(t)&&Object.keys(t).forEach(function(e){i[e]=a(t[e],r)}),Object.keys(n).forEach(function(e){r.isMergeableObject(n[e])&&t[e]?i[e]=function(e,t){if(!t.customMerge)return s;var n=t.customMerge(e);return"function"==typeof n?n:s}(e,r)(t[e],n[e],r):i[e]=a(n[e],r)}),i}function s(e,t,n){(n=n||{}).arrayMerge=n.arrayMerge||o,n.isMergeableObject=n.isMergeableObject||i;var r=Array.isArray(t);return r===Array.isArray(e)?r?n.arrayMerge(e,t,n):l(e,t,n):a(t,n)}return s.all=function(e,n){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(e,t){return s(e,t,n)},{})},s},"object"==typeof n&&void 0!==t?t.exports=i():"function"==typeof define&&define.amd?define(i):r.deepmerge=i()},{}]},{},[1]);
//# sourceMappingURL=fileUploader.js.map
