!function(a){var b=function(b,c){function d(b){a(n).addClass("highlight"),b.stopPropagation(),b.preventDefault(),b.dataTransfer.dropEffect="copy"}function e(c){a(n).removeClass("highlight"),c.stopPropagation(),c.preventDefault(),c.data={DOM:b},f._filesRead(c)}var f=this;this._defaults={lang:"en",useFileIcons:!0,debug:!1,debugLogStyle:"color: #9900ff",name:void 0,pluginName:"FileUploader",useLoadingBars:!0,loadingBarsClasses:[],reloadedFilesClass:"reloadedElement",resultContainerClass:"result",resultFileContainerClass:"uploadedFile",resultPrefix:"fileUploader",resultInputNames:["title","extension","value","size"],defaultFileExt:"",defaultMimeType:"",fileMaxSize:50,totalMaxSize:1e3,reloadArray:[],reloadHTML:void 0,linkButtonContent:"L",deleteButtonContent:"X",allowDuplicates:!1,duplicatesWarning:!1,HTMLTemplate:function(){return['<p class="introMsg"></p>',"<div>",'    <div class="inputContainer">','        <input class="fileLoader" type="file" multiple />',"    </div>",'    <div class="dropZone"></div>','    <div class="filesContainer filesContainerEmpty">','        <div class="innerFileThumbs"></div>','        <div style="clear:both;"></div>',"    </div>","</div>",'<div class="result"></div>'].join("\n")},onload:function(){},onfileloadStart:function(){},onfileloadEnd:function(){},onfileDelete:function(){},filenameTest:function(){},langs:{en:{intro_msg:"(Add attachments...)",dropZone_msg:"Drop your files here",maxSizeExceeded_msg:"File too large",totalMaxSizeExceeded_msg:"Total size exceeded",duplicated_msg:"File duplicated (skipped)",name_placeHolder:"name"}}},this._options=a.extend(!0,{},this._defaults,c),this.options=function(b){return b?a.extend(!0,this._options,b):this._options},this._round=function(a){return Math.round(100*a)/100},this.get=function(a){var b=this;switch(a){case"currentTotalSize":return b._round(r);case"currentAvailableSize":return b._round(b._options.totalMaxSize-r)}},this._logger=function(a,b,c){if(this._options.debug){if(b)for(var d=0;b>d;d++)a="âž¡ "+a;this._options.name&&(a="["+this._options.pluginName+" - "+this._options.name+"] "+a),c?console.log("%c "+a,this._options.debugLogStyle,c):console.log("%c "+a,this._options.debugLogStyle)}},this._fileType=function(a){var b=a.substring(a.lastIndexOf(".")+1,a.length),c=["pdf","jpg","png"];return c.indexOf(b)>=0?b:"unknown-file"},this._fileDelete=function(b){var c=b.data.element,d=a(b.target).data("delete");d||(d=a(b.target).closest("div[data-delete]").data("delete")),f._options.useFileIcons&&c.prev("img").remove(),c.remove();var e=i.find('input[name="'+f._options.resultPrefix+"["+d+"]["+f._options.resultInputNames[3]+']"]').val();e=f._round(e),r=f._round(r-e);var g=f._options.totalMaxSize-r;g=f._round(g),q.children("span").html(g),i.children('div[data-index="'+d+'"]').remove(),0===a(".innerFileThumbs").children().length&&a(".filesContainer").addClass("filesContainerEmpty"),f._logger("Deleted file N: "+d,2),f._options.onfileDelete(d,r)},this._fileRename=function(b){var c=b.data.element,d=a(b.target),e=c.children(".fileExt").html(),g=d.val(),h=c.data("index"),j=i.find('div[data-index="'+h+'"] input:first'),k=f._options.filenameTest(g,e,m);return k===!1?(b.preventDefault(),!1):void(void 0!==k&&k!==!0&&(g=k,d.val(g),e.length>0&&(g=g+"."+e),j.val(g),d[0].setSelectionRange(b.data.start,b.data.stop)))},this.getData=function(){var b=[];return this._logger("RECEIVED SAVE COMMAND:",0),a.each(i.children("."+this._options.resultFileContainerClass),function(c,d){var e={title:a(a(d).children("input")[0]).val(),ext:a(a(d).children("input")[1]).val(),value:a(a(d).children("input")[2]).val()};b.push(e)}),this._logger("%O",0,b),b},this._createUploaderContainer=function(b,c,d){var e="position: relative;";if(this._options.useFileIcons){var g=a('<img src="/images/'+this._fileType(d)+'.png" class="fileThumb" />');m.append(g)}var h=a('<div class="newElement" data-index="'+parseInt(b)+'" style="'+e+'"></div');m.append(h);var i=a('<div class="fileActions"></div>');h.append(i);var j=a('<a target="_blank"><div class="fileSee">'+f._options.linkButtonContent+"</div></a>");i.append(j);var k=a('<div data-delete="'+parseInt(b)+'" class="fileDelete">'+f._options.deleteButtonContent+"</div>");if(i.append(k),k.click({element:h},this._fileDelete),this._options.useLoadingBars){var l=f._options.loadingBarsClasses;l.length>0&&(l=l.join(" "));var n=a('<div class="loadBar '+l+'"><div></div></div>');h.prepend(n)}var o=a('<input placeholder="nome" class="fileTitle"></input>'),p=a('<div class="fileExt"></div>');return h.prepend(p),h.prepend(o),o.on("keypress keyup paste",function(a){a.data={},a.data.element=h,a.data.start=this.selectionStart,a.data.stop=this.selectionEnd,f._fileRename(a)}),o.val(c),p.html(d),h},this._createResultContainer=function(b){var c=b.index,d=a('<div data-index="'+c+'" class="'+f._options.resultFileContainerClass+'"></div>');d.append(a("<div>File: "+c+"</div>")),d.append(a("<input/>").attr({type:"text",name:f._options.resultPrefix+"["+c+"]["+f._options.resultInputNames[0]+"]",value:b.name})),d.append(a("<input/>").attr({type:"text",name:f._options.resultPrefix+"["+c+"]["+f._options.resultInputNames[1]+"]",value:b.type})),d.append(a("<input/>").attr({type:"text",name:f._options.resultPrefix+"["+c+"]["+f._options.resultInputNames[2]+"]",value:b.result})),d.append(a("<input/>").attr({type:"text",name:f._options.resultPrefix+"["+c+"]["+f._options.resultInputNames[3]+"]",value:b.size})),i.append(d)},this._filesRead=function(b){function c(b,c,d,e){var g=e.find(".innerFileThumbs").children().filter(function(){return a(this).data("index")===d}),h=f._round(c.size/1e6);if(b.onloadstart=function(){f._options.onfileloadStart(d),f._logger("START read file: "+d+", size: "+h+" MB",2)},b.onprogress=function(a){if(a.lengthComputable){var b=f._round(a.loaded/a.total*100);f._logger("File "+d+" loaded: "+b,3),100>=b&&g.children(".loadBar").children("div").animate({width:"100%"},500)}},b.onloadend=function(){var e=c.type,i=c.name,j=b.result,k=j.substring(0,j.indexOf(";"));"data:"===k&&f._options.defaultMimeType.length>0&&(j="data:"+f._options.defaultMimeType+j.substring(j.indexOf(";"),j.length)),""===e&&(e=f._options.defaultMimeType),i.indexOf(".")<0&&""!==f._options.defaultFileExt&&(i=i+"."+f._options.defaultFileExt);var l={index:d,name:i,type:e,result:j,size:h};f._createResultContainer(l),g.children(".fileActions").children("a").attr("href",j),f._logger("END read file: "+d,4);var m=parseInt(a("#debugUploaded").html())+1;a("#debugUploaded").html(m);var n={name:c.name,type:c.type,data:j,size:h};f._options.onfileloadEnd(d,n,f._round(r))},h<=f._options.fileMaxSize&&r+h<=f._options.totalMaxSize){b.readAsDataURL(c),r+=h;var i=f._options.totalMaxSize-r;q.children("span").html(f._round(i))}else{var j=o.totalMaxSizeExceeded_msg;h>f._options.fileMaxSize?(j=o.maxSizeExceeded_msg,f._logger("FILE REJECTED: Max size exceeded - max size: "+f._options.fileMaxSize+" MB - file size: "+h+" MB")):f._logger("FILE REJECTED: Max total size exceeded - max size: "+f._options.totalMaxSizeExceeded_msg+" MB - current total size: "+(r+h)+" MB"),g.addClass("error"),g.children(".loadBar").empty().append('<div class="errorMsg">'+j+"</div>"),setTimeout(function(){g.animate({opacity:0},300,function(){f._options.useFileIcons&&a(this).prev("img").remove(),a(this).remove()})},2e3);var k=parseInt(a("#debugRejected").html())+1;a("#debugRejected").html(k)}}function d(b){setTimeout(function(){b.animate({opacity:0},300,function(){a(this).remove()})},2e3)}var e,g=b.data.DOM,j=!1,n=0;if(b.target.files?(this._logger("files array source: file selector (click event)",1),e=b.target.files):(this._logger("files array source: dropzone (drag & drop event)",1),e=b.dataTransfer.files),this._logger("%O",0,e),!f._options.allowDuplicates){var p=[],s=[];for(j=[],a.each(i.children(),function(b,c){p.push(a(c).children("input").first().val())}),n=0;n<e.length;n++)s.push(e[n].name);s.forEach(function(a){var b=p.indexOf(a);0>b&&j.push(a)})}k.removeClass("filesContainerEmpty"),l.html("upload files");var t=a("#innerFileThumbs").children().last().attr("id");for(t=void 0!==t?parseInt(t.substring(t.indexOf("-")+1,t.length))+1:0,n=0;n<e.length;n++){var u=e[n],v=new FileReader;if(j&&j.indexOf(u.name)<0){if(f._options.duplicatesWarning){var w=a('<div class="errorLabel center"></div>');w.html(o.duplicated_msg),m.append(w),d(w)}this._logger("File duplicated: "+u.name+" -> skipping...",2)}else{var x,y;u.name.lastIndexOf(".")>0?(x=u.name.substring(0,u.name.lastIndexOf(".")),y=u.name.substring(u.name.lastIndexOf(".")+1,u.name.length)):(x=u.name,y=this._options.defaultFileExt);var z=this._options.filenameTest(x,y,m);z!==!1?(void 0!==z&&z!==!0&&(x=z),this._createUploaderContainer(h,x,y),c(v,u,h,g),h++):this._logger("Invalid file name: "+u.name,2)}}},this._options.name&&this._logger("INITIALIZED INSTANCE: "+this._options.name);var g=a(this._options.HTMLTemplate());b.append(g);var h=0,i=b.find("."+this._options.resultContainerClass),j=b.find(".fileLoader"),k=b.find(".filesContainer"),l=b.find(".fileNameContainer"),m=b.find(".innerFileThumbs"),n=b.find(".dropZone")[0],o=this._options.langs[this._options.lang];this._options.reloadHTML&&i.html(this._options.reloadHTML),b.find(".introMsg").html(o.intro_msg),a(n).html(o.dropZone_msg),this._options.debug?(a('<p class="debugMode">Debug mode: on</p>').insertBefore(i),a('<div class="debug">Uploaded files: <span id="debugUploaded">0</span> | Rejected files: <span id="debugRejected">0</span></div>').insertBefore(i),a('<div class="debug">Current MAX FILE SIZE: '+this._options.fileMaxSize+" MB</div>").insertBefore(i),a('<div class="debug">Current MAX TOTAL SIZE: '+this._options.totalMaxSize+" MB</div>").insertBefore(i),a('<div class="debug sizeAvailable">Size still available: <span>'+this._options.totalMaxSize+"</span> MB</div>").insertBefore(i)):i.addClass("hide");var p,q=b.find(".sizeAvailable"),r=0;a.each(i.children("."+this._options.resultFileContainerClass),function(b,c){f._logger("found previously uploaded file: index = "+a(c).data("index"),2);var d=a(c).children("input"),e=a(d[0]).val(),g=a(d[1]).val(),i=a(d[3]).val();e.lastIndexOf(".")>0&&(e=e.substr(0,e.lastIndexOf("."))),p=f._createUploaderContainer(h,e,g),p.children(".loadBar").children("div").css({width:"100%"}),p.addClass(f._options.reloadedFilesClass),r+=parseFloat(i),h++}),this._options.reloadArray.length>0&&this._options.reloadArray.forEach(function(a,b){p=f._createUploaderContainer(b,a.name,a.ext),p.children(".loadBar").children("div").css({width:"100%"}),p.addClass(f._options.reloadedFilesClass),f._logger("found previously uploaded file: index = "+b,2);var c={index:b,name:a.name,type:a.ext,result:a.data,size:a.size};f._createResultContainer(c),r+=parseFloat(a.size),h++}),r=f._round(r),this._logger("current total size: "+r),q.children("span").html(this._options.totalMaxSize-r),this._options.onload(this._options,r),n.addEventListener("dragleave",function(){a(n).removeClass("highlight")}),n.addEventListener("dragover",d,!1),n.addEventListener("drop",function(a){return function(b){e(b,a)}}(this),!1),a(n).click(function(){j.trigger("click")}),j.change({DOM:b},function(a){f._filesRead(a),this.value=null})};a.fn.fileUploader=function(c){function d(){var b=a(this),c=b.data("fileUploader");h.push(c)}function e(a){var b=h[a];if(!b)return console.warn("$.fileUploader not instantiated yet"),console.info(this),void j.push(void 0);if("function"==typeof b[g]){var c=b[g].apply(b,i);j.push(c)}else console.warn("Method '"+g+"' not defined in $.fileUploader")}function f(){var c=a(this),d=new b(c,k);c.data("fileUploader",d)}var g="string"==typeof c?c:void 0;if(g){var h=[];this.each(d);var i=arguments.length>1?Array.prototype.slice.call(arguments,1):void 0,j=[];return this.each(e),j.length>1?j:j[0]}var k="object"==typeof c?c:void 0;return this.each(f)}}(jQuery);